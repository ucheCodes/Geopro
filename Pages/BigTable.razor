  @inject State state

        @if(state.HeaderArray.Value != null && state.HeaderArray.Value.Count > 0 && dataArray != null && dataArray.Count > 0)
        {
            <div class="dynamic-table">
                <div class="table-header">
                    <h3 class="heading">@TableTiltle</h3>
                    <bold>@dataCount data points</bold>
                </div>
                    <div class="table large">
                    <div class="table-body">
                        <table>
                            <thead>
                                @if(state.Data2Show.Value == "processed" && state.HeaderIndexDict.Value.Count() > 0)
                                {
                                    <tr>
                                    @foreach(var kvp in state.HeaderIndexDict.Value)
                                    {
                                            @if(!string.IsNullOrWhiteSpace(kvp.Value) && state.HeaderUnitDict.Value.ContainsKey(kvp.Key))
                                            {
                                                string header = $"{kvp.Value} \n  {state.HeaderUnitDict.Value[kvp.Key]}";
                                                <th>@header</th>
                                            }
                                    }
                                    </tr>
                                }
                                else
                                {
                                    @foreach(var row in state.HeaderArray.Value)
                                    {
                                        <tr>
                                            @foreach(var data in row)
                                            {
                                                if(!string.IsNullOrWhiteSpace(data))
                                                {
                                                    <th>@data</th>
                                                }
                                            }
                                        </tr>
                                    }
                                }
                            </thead>
                            <tbody>
                                @if((state.Data2Show.Value == "raw" || state.Data2Show.Value == "decay") && dataArray.Count > 0)
                                {
                                    foreach(var row in dataArray)
                                {
                                    int index = 0;
                                    <tr>
                                        @foreach(var data in row)
                                        {
                                            string xDepth = row[0];
                                            if(!string.IsNullOrWhiteSpace(data) && state.HeaderIndexDict.Value.ContainsKey(index))// && ParseAndPopulateData(index, xDepth, data)
                                            {
                                                <td>@data</td>
                                            }
                                            else
                                            {
                                                <td class="red">@data</td>
                                            }
                                            index++;
                                        }
                                    </tr>
                                }
                                }
                                else if(state.Data2Show.Value == "filtered" && filteredRawDataInRowsArray.Count > 0)
                                {
                                    foreach(var row in filteredRawDataInRowsArray)
                                    {
                                        int index = 0;
                                        <tr>
                                            @foreach(var data in row)
                                            {
                                                if(state.HeaderIndexDict.Value.ContainsKey(index))
                                                {
                                                    <td>@data</td>
                                                }
                                                else
                                                {
                                                    <td class="red">@data</td>
                                                }
                                                index++;
                                            }
                                        </tr>
                                    }
                                }
                                else if(state.Data2Show.Value == "processed" && state.FilteredAndComputedCPTDataInColumnsDict.Value.Count() > 0)
                                {
                                    var data = state.FilteredAndComputedCPTDataInColumnsDict.Value;
                                    int maxDataCount = data.Values.Max(list => list.Count);
                                    for(int i = 0; i < maxDataCount; i++)
                                    {
                                        <tr>
                                            @foreach(var columnOfData in data.Values)
                                            {
                                                if(i < columnOfData.Count)
                                                {
                                                    <td>@columnOfData[i]</td>
                                                }
                                            }
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
}       

@code {
    [Parameter]
    public string TableTiltle {get;set;} = "";
    [Parameter]
    public List<double[]> filteredRawDataInRowsArray {get; set;} = new();
    [Parameter]
    public List<string[]> dataArray {get; set;} = new();
    int dataCount = 0;
    protected override void OnAfterRender(bool firstRender)
    {
        if(state.Data2Show.Value == "raw")
        {
             dataCount = dataArray.Count;
        }
        else if(state.Data2Show.Value == "filtered")
        {
             dataCount = filteredRawDataInRowsArray.Count;
        }
        else if(state.Data2Show.Value == "processed")
        {
             dataCount = state.FilteredAndComputedCPTDataInColumnsDict.Value.Count;
        }
    }
}
